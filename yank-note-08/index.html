<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Yank Note 系列 08 - 优化 Katex 公式渲染性能 | 洋子的自留地</title>
    <meta name="generator" content="VuePress 1.9.10">
    <link rel="alternate" type="application/rss+xml" href="https://purocean.github.io/rss.xml" title="洋子的自留地 RSS Feed">
    <meta name="description" content="Yank Note 是我编写的一款面向程序员的笔记应用。这里我将会写下一些关于 Yank Note 的文章
&gt; - Yank Note 系列 01 - 为什么要自己写笔记软件？
&gt; - Yank Note 系列 02 - Markdown 渲染性能优化之路
&gt; ...">
    
    <link rel="preload" href="/assets/css/0.styles.5ee86e3d.css" as="style"><link rel="preload" href="/assets/js/app.eb9f9003.js" as="script"><link rel="preload" href="/assets/js/4.a919a368.js" as="script"><link rel="preload" href="/assets/js/1.b0bbcc77.js" as="script"><link rel="preload" href="/assets/js/13.ed891f49.js" as="script"><link rel="prefetch" href="/assets/js/11.8d29bb1f.js"><link rel="prefetch" href="/assets/js/12.ebc662de.js"><link rel="prefetch" href="/assets/js/14.9d2f201d.js"><link rel="prefetch" href="/assets/js/15.54f4a3d9.js"><link rel="prefetch" href="/assets/js/16.846050e5.js"><link rel="prefetch" href="/assets/js/17.c6a2bbc8.js"><link rel="prefetch" href="/assets/js/18.66fb8bc7.js"><link rel="prefetch" href="/assets/js/19.a70e5f6f.js"><link rel="prefetch" href="/assets/js/2.d9736519.js"><link rel="prefetch" href="/assets/js/20.d5dd728f.js"><link rel="prefetch" href="/assets/js/21.3f30521e.js"><link rel="prefetch" href="/assets/js/22.66343f4a.js"><link rel="prefetch" href="/assets/js/23.c176132e.js"><link rel="prefetch" href="/assets/js/24.69166df7.js"><link rel="prefetch" href="/assets/js/25.b5c2c5f1.js"><link rel="prefetch" href="/assets/js/26.a3e36f84.js"><link rel="prefetch" href="/assets/js/27.8ad76597.js"><link rel="prefetch" href="/assets/js/28.2b42ab80.js"><link rel="prefetch" href="/assets/js/29.efaefbb5.js"><link rel="prefetch" href="/assets/js/3.605ef2e9.js"><link rel="prefetch" href="/assets/js/30.955ad667.js"><link rel="prefetch" href="/assets/js/31.064ef281.js"><link rel="prefetch" href="/assets/js/32.5f88d44e.js"><link rel="prefetch" href="/assets/js/33.2fc19e88.js"><link rel="prefetch" href="/assets/js/34.5a0d2a6b.js"><link rel="prefetch" href="/assets/js/35.1b99631d.js"><link rel="prefetch" href="/assets/js/36.c1fb9a25.js"><link rel="prefetch" href="/assets/js/37.7643d68e.js"><link rel="prefetch" href="/assets/js/38.9c71544d.js"><link rel="prefetch" href="/assets/js/39.9b77b86d.js"><link rel="prefetch" href="/assets/js/40.5770bcf5.js"><link rel="prefetch" href="/assets/js/41.04fc2396.js"><link rel="prefetch" href="/assets/js/42.b92ed718.js"><link rel="prefetch" href="/assets/js/43.93eeb3e4.js"><link rel="prefetch" href="/assets/js/44.6a23f7e7.js"><link rel="prefetch" href="/assets/js/45.b78c673a.js"><link rel="prefetch" href="/assets/js/46.35027471.js"><link rel="prefetch" href="/assets/js/47.0838f5cd.js"><link rel="prefetch" href="/assets/js/48.2ae7bad5.js"><link rel="prefetch" href="/assets/js/49.23d9b4d7.js"><link rel="prefetch" href="/assets/js/5.1f904404.js"><link rel="prefetch" href="/assets/js/50.10ec8c3f.js"><link rel="prefetch" href="/assets/js/51.415c8ea0.js"><link rel="prefetch" href="/assets/js/52.0a86f5b4.js"><link rel="prefetch" href="/assets/js/53.4d1c72cb.js"><link rel="prefetch" href="/assets/js/54.1af5a13e.js"><link rel="prefetch" href="/assets/js/55.27d5b373.js"><link rel="prefetch" href="/assets/js/6.1aed2db1.js"><link rel="prefetch" href="/assets/js/7.efa58335.js"><link rel="prefetch" href="/assets/js/8.0c59f90a.js"><link rel="prefetch" href="/assets/js/vuejs-paginate.2352b21b.js">
    <link rel="stylesheet" href="/assets/css/0.styles.5ee86e3d.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div id="vuepress-theme-blog__global-layout"><section id="header-wrapper"><header id="header"><div class="header-wrapper"><div class="title"><a href="/" class="nav-link home-link">洋子的自留地 </a></div> <div class="header-right-wrap"><ul class="nav"><li class="nav-item"><a href="/" class="nav-link">首页</a></li><li class="nav-item"><a href="/tag/" class="nav-link">标签</a></li></ul> <div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <a href="/rss.xml" class="feed"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-rss"><path d="M4 11a9 9 0 0 1 9 9"></path><path d="M4 4a16 16 0 0 1 16 16"></path><circle cx="5" cy="19" r="1"></circle></svg></a></div></div></header></section> <div id="mobile-header"><div class="mobile-header-bar"><div class="mobile-header-title"><a href="/" class="nav-link mobile-home-link">洋子的自留地 </a> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line></svg></div> <div class="mobile-menu-wrapper"><hr class="menu-divider"> <ul class="mobile-nav"><li class="mobile-nav-item"><a href="/" class="nav-link">首页</a></li><li class="mobile-nav-item"><a href="/tag/" class="nav-link">标签</a></li> <li class="mobile-nav-item"><a href="/rss.xml" class="feed"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-rss"><path d="M4 11a9 9 0 0 1 9 9"></path><path d="M4 4a16 16 0 0 1 16 16"></path><circle cx="5" cy="19" r="1"></circle></svg></a></li></ul></div></div></div> <div class="content-wrapper"><div id="vuepress-theme-blog__post-layout"><article itemscope="itemscope" itemtype="https://schema.org/BlogPosting" class="vuepress-blog-theme-content"><header><h1 itemprop="name headline" class="post-title">
        Yank Note 系列 08 - 优化 Katex 公式渲染性能
      </h1> <div class="post-meta"><div itemprop="publisher author" itemtype="http://schema.org/Person" itemscope="itemscope" class="post-meta-author"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-navigation"><polygon points="3 11 22 2 13 21 11 13 3 11"></polygon></svg> <span itemprop="name">洋子</span> <!----></div> <div class="post-meta-date"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-clock"><circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline></svg> <time pubdate itemprop="datePublished" datetime="2022-10-16T00:00:00.000Z">
      2022-10-16
    </time></div> <ul itemprop="keywords" class="post-meta-tags"><li class="post-tag" data-v-42ccfcd5><a href="/tag/Yank-Note" data-v-42ccfcd5><span data-v-42ccfcd5>Yank-Note</span></a></li></ul></div></header> <div itemprop="articleBody" class="content__default"><blockquote><p><a href="https://github.com/purocean/yn" target="_blank" rel="noopener noreferrer">Yank Note<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 是我编写的一款面向程序员的笔记应用。这里我将会写下一些关于 Yank Note 的文章</p> <ul><li><a href="/yank-note-01">Yank Note 系列 01 - 为什么要自己写笔记软件？</a></li> <li><a href="/yank-note-02">Yank Note 系列 02 - Markdown 渲染性能优化之路</a></li> <li><a href="/yank-note-03">Yank Note 系列 03 - 同内存泄露的艰难战斗！</a></li> <li><a href="/yank-note-04">Yank Note 系列 04 - 编辑和预览同步滚动方案</a></li> <li><a href="/yank-note-05">Yank Note 系列 05 - 关于本地历史功能</a></li> <li><a href="/yank-note-06">Yank Note 系列 06 - 使用人工智能写文章是什么体验？</a></li> <li><a href="/yank-note-07">Yank Note 系列 07 - 性能暴增 132 倍的秘密——重写</a></li> <li><a href="/yank-note-08">Yank Note 系列 08 - 优化 Katex 公式渲染性能</a></li> <li><a href="/yank-note-09">Yank Note 系列 09 - 关于流的使用</a></li> <li><a href="/yank-note-10">Yank Note 系列 10 - 新增自定义快捷键功能</a></li> <li><a href="/yank-note-11">Yank Note 系列 11 - 预览内查找功能</a></li> <li><a href="/yank-note-12">Yank Note 系列 12 - 高效构建仓库索引与知识图谱</a></li></ul></blockquote> <blockquote><p>注：本文很多结论是实验得出的推断，如有误欢迎指正。</p></blockquote> <h2 id="问题"><a href="#问题" class="header-anchor">#</a> 问题</h2> <p>不久前一位用户反馈，说使用 Yank Note 打开包含大量公式，几十万字符的文档十分卡顿。</p> <p>话不多说，先建立一个测试文档，大约六千行，30 万字符，几乎全部是公式。</p> <p>经过测试，发现有如下几个环节比较卡顿：</p> <ol><li>打开文档时间较长</li> <li>滚动编辑器十分卡顿，没开启同步滚动也是如此</li> <li>文字输入时候很卡顿</li></ol> <p>而在之前的文章里，我已经讲述了为了优化性能所做的努力。如果不含大量公式，卡顿可能出现在环节 1，也不至于有环节 2 和环节 3 的问题。所以还需要进一步排查。</p> <p>先说一下打开文档的过程。</p> <p>要处理如此大的文档，需要处理几秒钟也很正常。使用 Typora 打开，情况也不乐观，不过 Typora 应该做了缓存，第二次打开就快了不少。</p> <p><img alt="Img" data-src="/assets/img/img-20221016195619.04ecab0c.png" loading="lazy" class="lazy"></p> <p>针对这种情况，一般优化都是“懒加载”。但我不喜欢这种方案——界面跳动闪烁、东西要出现在视口再显示（除非特别快，能用虚拟列表的场景）。这些就是我前面说的让应用变得复杂的例子。</p> <p>那么还有什么可以改进的呢？那就是在打开文档时候，整个应用变得不可交互了。要处理这个就必须把渲染完全独立于应用才可以。理论上说，为了安全性和应用可响应，用户内容应该完全和应用主体隔离开，不过目前就不展开了，以后能有机会再慢慢做吧。</p> <p>所以界定这次优化的主要目标：</p> <ol><li>优化滚动交互体验</li> <li>优化文档编辑输入体验</li></ol> <h2 id="滚动交互优化"><a href="#滚动交互优化" class="header-anchor">#</a> 滚动交互优化</h2> <p>编辑器的流畅性对体验很重要。而这方面你完全可以信任 Monaco 编辑器，这点文本量是毫无压力的。但是为什么在关闭同步滚动后，编辑器依然非常卡顿呢？</p> <p><img alt="Img" data-src="/assets/img/img-20221016203246.41fba63e.png" loading="lazy" class="lazy"></p> <p>可以看到浏览器花了大量时间在 <em>Update Layer Tree</em> 和 <em>Hit Test</em> 操作上。</p> <p>再测试一下预览区独立滚动情况，感官上还是比较流畅。但用性能分析工具一看，在滚动较慢的时候，性能非常差。查看帧数也只有 10 帧不到！</p> <p><img alt="Img" data-src="/assets/img/img-20221016202235.cd741504.png" loading="lazy" class="lazy"></p> <p>这里也花了大量时间在 <em>Update Layer Tree</em> 上。</p> <p>按照我的理解，既然页面都渲染出来了，仅仅是滚动，甚至是其他元素无关的滚动，为什么有那么多 <em>Update Layer Tree</em> 的操作？</p> <h3 id="理论储备"><a href="#理论储备" class="header-anchor">#</a> 理论储备</h3> <p>说到优化渲染性能，就不得不提到这张很经典的像素流水线图</p> <p><img alt="Img" data-src="/assets/img/img-20221016204154.87cc659b.png" loading="lazy" class="lazy"></p> <p>不过我觉得更细化到应该是下面这张图</p> <p><img alt="Img" data-src="/assets/img/img-20221016204022.1d2e3aa9.png" loading="lazy" class="lazy"></p> <p>现在的问题是出在图层合并上。需要看一下图层相关有没有什么问题。</p> <p>而关于 <em>Hit Test</em>，这是用来计算鼠标命中的，将鼠标移到应用外部，用键盘滚动，这一块时间就消失了。</p> <h3 id="尝试一-使用-css-contain-属性优化"><a href="#尝试一-使用-css-contain-属性优化" class="header-anchor">#</a> 尝试一：使用 CSS contain 属性优化</h3> <p>关于 <code>contain</code> 属性，可以看 MDN 相关文章。总的来说，它就是为了性能优化而生的。</p> <p>给预览区滚动容器加上 <code>contain: static</code> ，公式容器加上 <code>contain: paint</code>。再次测试，<em>Update Layer Tree</em> 操作时间从之前的 180ms 下降到了 30ms 左右，提升巨大！</p> <p><img alt="Img" data-src="/assets/img/img-20221016205437.5cbc345c.png" loading="lazy" class="lazy"></p> <h3 id="尝试二-去掉-relative-定位"><a href="#尝试二-去掉-relative-定位" class="header-anchor">#</a> 尝试二：去掉 relative 定位</h3> <p>从上面的图可以看到 <em>Hit Test</em> 花了大量时间。</p> <p>但是预览区域是独立的一个层，也不会有元素溢出。虽然里面有大量 DOM 节点，但是我的鼠标在编辑器，理论不会有很多元素参与 <em>Hit Test</em> 计算，时间消耗也应该不会那么多吧。</p> <p>经过测试，发现只要去掉公式的相对定位，即可消除这一块的时间。</p> <p><img alt="Img" data-src="/assets/img/img-20221016210924.385cb6c3.png" loading="lazy" class="lazy"></p> <p>看来元素相对定位会影响到浏览器做 <em>Hit Test</em>。不过这一块我也没看到有人讨论这个事，懂的可以指教一下。</p> <h3 id="尝试三-使用-web-components"><a href="#尝试三-使用-web-components" class="header-anchor">#</a> 尝试三：使用 Web Components</h3> <p>Vue 3 可以非常容易的将现有组件转换成 Web Components。</p> <p>但是经过测试，完全没用。该有的布局和图层操作都不会少。</p> <h3 id="最终解决方案-iframe-隔离"><a href="#最终解决方案-iframe-隔离" class="header-anchor">#</a> 最终解决方案：iframe 隔离</h3> <p>经过了上面的尝试，编辑器滚动性能提高了不少，但帧率还是 30 帧都达不到。并且去掉公式的 relative 定位，连功能都不能保证正常了。所以上面的尝试只能作为探究性能障碍用，完全不能作为解决方案。</p> <p>再加上文档 DOM 节点过多，应用其他地方操作也不流畅了。看来还是只有隔离 iframe 渲染这一条路可走。欠下的债还是要还的。</p> <p>Yank Note 是一步一步演化而来的，完全没有“顶层设计”。理论上说文档的渲染内容，应该要隔离到一个单独的沙盒中，兼顾安全和性能。这方面 VSCode 的架构做得非常牛逼和完善。</p> <p>不过 Yank Note 是简单的东西，先不搞复杂了，就只是用 iframe 做渲染吧。为了 Hackable，js 进程也不隔离了。</p> <p><strong>具体方案</strong></p> <ol><li>新开一个 iframe</li> <li>使用 Vue 3 <em>Teleport</em> 标签，将文档内容渲染到 iframe</li> <li>做好样式注入、DOM 获取、打印等等后续工作。</li></ol> <p>经过了上面的折腾后，编辑器独立滚动时候，已经非常流畅了。但是预览区滚动，性能还是非常差劲。仍然是 <em>Update Layer Tree</em> 非常耗时。</p> <p>于是我把文档导成 HTML，用浏览器打开，滚动测试性能，非常流畅。这里唯一的区别是，在应用中，文档在 div 中滚动。而导出的文档则是在 html 中滚动。</p> <p>后面<a href="https://www.zhihu.com/question/268016229" target="_blank" rel="noopener noreferrer">搜到一点信息<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>，大概就是确实有这个问题，容器设置背景色可以优化，但是试验了一番也没什么效果。所以干脆就直接整个页面滚动。</p> <p>将滚动容器改变后，整体性能一下子就起来了。在开启同步滚动的情况下，编辑器可以很流畅的滚动了，性能分析也没有 <em>Long Task</em> 了，达到了预期的目的。</p> <p><img alt="Img" data-src="/assets/img/img-20221016214319.06d2f7b9.png" loading="lazy" class="lazy"></p> <h2 id="编辑输入优化"><a href="#编辑输入优化" class="header-anchor">#</a> 编辑输入优化</h2> <p>再说说输入优化。这里就容易多了。直接用工具分析。</p> <p><img alt="Img" data-src="/assets/img/img-20221016212729.4a0a5ba3.png" loading="lazy" class="lazy"></p> <h3 id="公式渲染增加缓存"><a href="#公式渲染增加缓存" class="header-anchor">#</a> 公式渲染增加缓存</h3> <p>从上面可以看到公式渲染花了很长时间，但是用户在打字的时候，一般只会更新一个公式。其他公式是没有必要去再次解析的。这里可以加上缓存。</p> <h3 id="减少-vue-key-长度"><a href="#减少-vue-key-长度" class="header-anchor">#</a> 减少 Vue Key 长度</h3> <p>加上缓存后，渲染多次进行测试。又发现 Vue 更新 DOM 节点花了很长时间。</p> <p><img alt="Img" data-src="/assets/img/img-20221016214744.926b1d4a.png" loading="lazy" class="lazy"></p> <p>问题出现在对比虚拟节点 key 上面。</p> <p>之前我是直接将公式 HTML 字符串作为 key。但是这个字符串可能会很长。和公式源码的差距可能达到几十上百倍。</p> <p>改用公式源码+配置做 key 之后，这一句代码消耗时间下降到了零点几毫秒。</p> <h3 id="使用-requestidlecallback"><a href="#使用-requestidlecallback" class="header-anchor">#</a> 使用 requestIdleCallback</h3> <p>通过使用 <code>requestIdleCallback</code> 将不重要的如目录大纲更新、待办数量计算等放到浏览器空闲时候执行，也可以一定程度优化体验。不过很可惜这个 Api 不支持 Safari。</p> <h3 id="动态防抖优化"><a href="#动态防抖优化" class="header-anchor">#</a> 动态防抖优化</h3> <p>文字输入的交互优先级比实时渲染高。之前做的防抖渲染时间只是是根据 markdown-it 解析时间来预估的，没有考虑到渲染时间，所以在渲染复杂文档时候，预估的时间会偏小。加上渲染时间后，在文字输入时候卡顿情况就更少了。</p> <h2 id="一点感想"><a href="#一点感想" class="header-anchor">#</a> 一点感想</h2> <p>为什么我要一直和性能死磕呢，除了让产品有更好的体验外，另一个很重要的原因是平时的工作中，很少能有机会能接触到性能优化相关的东西，也很难深入细节去了解技术。</p> <p>因此如果有性能上可以优化的地方——不会让应用过于复杂，也不会损失一般情况下性能和体验——我就会觉得非常开心。</p> <h2 id="参考"><a href="#参考" class="header-anchor">#</a> 参考</h2> <ol><li><a href="https://web.dev/rendering-performance/" target="_blank" rel="noopener noreferrer">Rendering Performance<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://developer.chrome.com/articles/renderingng-architecture/" target="_blank" rel="noopener noreferrer">Overview of the RenderingNG architecture<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://developer.mozilla.org/zh-CN/docs/Web/CSS/contain" target="_blank" rel="noopener noreferrer">contain - CSS（层叠样式表） | MDN<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://www.zhihu.com/question/268016229" target="_blank" rel="noopener noreferrer">chrome下div滚动卡顿该怎么处理？ - 知乎<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ol> <blockquote><p>本文由「<a href="https://github.com/purocean/yn" target="_blank" rel="noopener noreferrer">Yank Note - 一款面向程序员的 Markdown 笔记应用<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>」撰写</p></blockquote></div> <footer><!----> <hr> <!----></footer></article> <div class="sticker vuepress-toc"><div class="vuepress-toc-item vuepress-toc-h2 active"><a href="#问题" title="问题">问题</a></div><div class="vuepress-toc-item vuepress-toc-h2"><a href="#滚动交互优化" title="滚动交互优化">滚动交互优化</a></div><div class="vuepress-toc-item vuepress-toc-h3"><a href="#理论储备" title="理论储备">理论储备</a></div><div class="vuepress-toc-item vuepress-toc-h3"><a href="#尝试一-使用-css-contain-属性优化" title="尝试一：使用 CSS contain 属性优化">尝试一：使用 CSS contain 属性优化</a></div><div class="vuepress-toc-item vuepress-toc-h3"><a href="#尝试二-去掉-relative-定位" title="尝试二：去掉 relative 定位">尝试二：去掉 relative 定位</a></div><div class="vuepress-toc-item vuepress-toc-h3"><a href="#尝试三-使用-web-components" title="尝试三：使用 Web Components">尝试三：使用 Web Components</a></div><div class="vuepress-toc-item vuepress-toc-h3"><a href="#最终解决方案-iframe-隔离" title="最终解决方案：iframe 隔离">最终解决方案：iframe 隔离</a></div><div class="vuepress-toc-item vuepress-toc-h2"><a href="#编辑输入优化" title="编辑输入优化">编辑输入优化</a></div><div class="vuepress-toc-item vuepress-toc-h3"><a href="#公式渲染增加缓存" title="公式渲染增加缓存">公式渲染增加缓存</a></div><div class="vuepress-toc-item vuepress-toc-h3"><a href="#减少-vue-key-长度" title="减少 Vue Key 长度">减少 Vue Key 长度</a></div><div class="vuepress-toc-item vuepress-toc-h3"><a href="#使用-requestidlecallback" title="使用 requestIdleCallback">使用 requestIdleCallback</a></div><div class="vuepress-toc-item vuepress-toc-h3"><a href="#动态防抖优化" title="动态防抖优化">动态防抖优化</a></div><div class="vuepress-toc-item vuepress-toc-h2"><a href="#一点感想" title="一点感想">一点感想</a></div><div class="vuepress-toc-item vuepress-toc-h2"><a href="#参考" title="参考">参考</a></div></div></div></div> <footer class="footer" data-v-3d9deeb8><div class="footer-left-wrap" data-v-3d9deeb8><ul class="contact" data-v-3d9deeb8><li class="contact-item" data-v-3d9deeb8><a href="https://github.com/purocean/blog" target="_blank" rel="noopener noreferrer" class="nav-link external" data-v-3d9deeb8><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-github" data-v-3d9deeb8><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22" data-v-3d9deeb8></path></svg>
          
        </a></li></ul></div> <div class="footer-right-wrap" data-v-3d9deeb8><ul class="copyright" data-v-3d9deeb8><li class="copyright-item" data-v-3d9deeb8>Powered by VuePress | Copyright © 2019-present</li><li class="copyright-item" data-v-3d9deeb8><a href="https://beian.miit.gov.cn/" target="_blank" rel="noopener noreferrer" class="nav-link external" data-v-3d9deeb8>蜀ICP备2023032883号-1</a></li></ul></div></footer></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.eb9f9003.js" defer></script><script src="/assets/js/4.a919a368.js" defer></script><script src="/assets/js/1.b0bbcc77.js" defer></script><script src="/assets/js/13.ed891f49.js" defer></script>
  </body>
</html>
